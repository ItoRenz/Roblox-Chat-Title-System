-- ========================================
-- CHAT TITLE SYSTEM - SERVER
-- Author: ItoRenz00
-- Version: 1.1.0
-- Description:
-- Manages player roles and broadcasts role data for chat titles.
-- Place this Script in ServerScriptService
-- ========================================

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local PlayerRoles = {
	["YourUsername"] = {"Owner", Color3.fromRGB(255, 0, 0)},
	["HeadAdminUsername"] = {"Head Admin", Color3.fromRGB(255, 85, 0)},
	["AdminUsername"] = {"Admin", Color3.fromRGB(255, 170, 0)},
	["ItoRenz00"] = {"Dev", Color3.fromRGB(0, 170, 255)},
	["VIPUsername"] = {"VIP", Color3.fromRGB(255, 215, 0)},
	["StreamerUsername"] = {"Streamer", Color3.fromRGB(138, 43, 226)},
	["Top1Username"] = {"Top 1", Color3.fromRGB(255, 223, 0)},
	["Top2Username"] = {"Top 2", Color3.fromRGB(192, 192, 192)},
	["Top3Username"] = {"Top 3", Color3.fromRGB(205, 127, 50)},
}

local PLAYER_READY_DELAY = 0.5

local RoleEvent = Instance.new("RemoteEvent")
RoleEvent.Name = "GetPlayerRole"
RoleEvent.Parent = ReplicatedStorage

local function getPlayerRole(playerName)
	return PlayerRoles[playerName]
end

local function broadcastRoleToAllClients(targetPlayerName)
	local role = getPlayerRole(targetPlayerName)
	if role then
		for _, client in ipairs(Players:GetPlayers()) do
			RoleEvent:FireClient(client, "UpdateRole", targetPlayerName, role)
		end
	end
end

local function sendAllRolesToNewPlayer(newPlayer)
	task.wait(PLAYER_READY_DELAY)
	for _, otherPlayer in ipairs(Players:GetPlayers()) do
		local role = getPlayerRole(otherPlayer.Name)
		if role then
			RoleEvent:FireClient(newPlayer, "UpdateRole", otherPlayer.Name, role)
		end
	end
end

local function broadcastRoleRemoval(playerName)
	for _, client in ipairs(Players:GetPlayers()) do
		RoleEvent:FireClient(client, "RemoveRole", playerName)
	end
end

local loggedPlayers = {}

local function logRoleConfiguration()
	local roleCount = 0
	for _ in pairs(PlayerRoles) do
		roleCount = roleCount + 1
	end
	
	print(string.format("[Chat Title System] Loaded %d player role(s)", roleCount))
	for username, roleData in pairs(PlayerRoles) do
		print(string.format("  - %s: [%s]", username, roleData[1]))
	end
end

RoleEvent.OnServerEvent:Connect(function(player, action, targetPlayerName)
	if action == "RequestRole" and typeof(targetPlayerName) == "string" then
		local role = getPlayerRole(targetPlayerName)
		if role then
			RoleEvent:FireClient(player, "UpdateRole", targetPlayerName, role)
		end
	else
		warn(string.format("[Chat Title System] Invalid request from %s: action=%s, target=%s", 
			player.Name, tostring(action), tostring(targetPlayerName)))
	end
end)

Players.PlayerAdded:Connect(function(player)
	sendAllRolesToNewPlayer(player)
	
	local role = getPlayerRole(player.Name)
	if role and not loggedPlayers[player.Name] then
		task.wait(PLAYER_READY_DELAY + 0.1)
		broadcastRoleToAllClients(player.Name)
		loggedPlayers[player.Name] = true
		print(string.format("[Chat Title System] %s joined with role: [%s]", player.Name, role[1]))
	end
end)

Players.PlayerRemoving:Connect(function(player)
	broadcastRoleRemoval(player.Name)
	loggedPlayers[player.Name] = nil
	print(string.format("[Chat Title System] %s left the game", player.Name))
end)

print("========================================")
print("[Chat Title System] Server successfully loaded!")
print("[Chat Title System] Ready for multiplayer support")
print("========================================")

logRoleConfiguration()

task.wait(1)
for _, existingPlayer in ipairs(Players:GetPlayers()) do
	if getPlayerRole(existingPlayer.Name) then
		broadcastRoleToAllClients(existingPlayer.Name)
		loggedPlayers[existingPlayer.Name] = true
	end
end

print("Author: ItoRenz00")
